# Ramp Collision Notes

- **Symptom**: Characters failed to move up or down ramps when solid blocks existed directly beneath or adjacent to the slope. The player caught on hidden square tiles even though only the ramp surface was visible, and the debug capsule occasionally hovered above the ramp instead of settling on it.
- **Root Cause**: The narrow-phase resolver processed rectangular tiles before ramps and treated tiles that were geometrically hidden by the ramp plane as blocking geometry. Horizontal sweeps also treated those tiles as solid walls before the body had a chance to project onto the ramp surface, so the capsule hovered instead of following the incline.
- **Fix Summary**:
  - Replaced the heuristic snapper with an analytic capsule-vs-segment solver: the capsule foot circle now measures its distance to the rampâ€™s diagonal edge and applies the exact minimal translation whenever that distance falls below the radius.
  - The same surface sample feeds both the penetration loop and the axis sweeps, so tiles tucked beneath the active ramp are ignored while vertical and horizontal side walls still behave like solids when approached without support.
  - Final alignment happens inside `resolvePenetrations` by re-sampling the slope after each correction, which keeps the capsule tangent to the triangle with no residual overlap or jitter.
  - Ramp support data is recomputed lazily when the body drifts, preventing hover gaps without pulling the character sideways, and all velocity components into the slope are cancelled in one place.
  - Capsule debug overlays now reflect the corrected geometry because collider updates happen after the analytic projection rather than a post-step snap.
- **Tests Added**: `movingUpRightRampIgnoresSupportTileBeneath`, `movingDownLeftRampIgnoresSupportTileBeneath`, `climbingOffsetRampsSkipsCornerTile`, `descendingOffsetRampsStaysOnSurface`, `climbingOffsetLeftRampsSkipsCornerTile`, `descendingOffsetLeftRampsStaysOnSurface`, `horizontalContactWithCornerTileRemainsSolid`, `horizontalContactWithLeftCornerTileRemainsSolid`, `descendingRampPairWithSupportTileAllowsLeftwardMovement`, `hoveringAboveRampSnapsDown`, and `standingOnRampIgnoresSupportTile` cover ascent/descent with support blocks directly beneath a ramp, diagonal seams, mirrored layouts with adjacent tiles, side impacts that must remain solid, the ability to walk down from seams without jumping, and regression for the hover snap fix.
- **Follow-ups**: If new ramp orientations are introduced, extend the support solver tolerances, and add regression cases that mix ramps with adjacent flat tiles.
